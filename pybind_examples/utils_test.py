#!/usr/bin/env python3
'''Test APIs'''

import unittest
import time
import duckdb
import numpy as np
import pandas as pd

from pybind_examples.myutils import compute_total_air_duration_min, compute_total_duration_min, StringVector


def dbrun(query: str) -> pd.DataFrame:
    """run the query with duckdb"""
    dbcon = duckdb.connect()
    result = dbcon.query(query).to_df()
    return result


class TestUtils(unittest.TestCase):
    '''Test Utils'''

    @classmethod
    def setUpClass(cls):
        cls.leg_list = [
            ['MIDCPD_RM2736_2022-06-19_Y', '2022-06-19 05:40:00', 140],
            ['MCVBDT_RM1171_2022-06-19_Y', '2022-06-19 05:40:00', 100],
            ['QJATLF_RM1901_2022-06-19_Y', '2022-06-19 06:30:00', 120],
            ['BWVNEL_RM3580_2022-06-19_Y', '2022-06-19 07:00:00', 110],
            ['EGQFNS_RM1695_2022-06-19_Y', '2022-06-19 07:20:00', 110],
            ['TLFCWU_RM2051_2022-06-19_Y', '2022-06-19 07:40:00', 80],
            ['TOITCQ_RM1324_2022-06-19_Y', '2022-06-19 08:20:00', 90],
            ['QJAIQX_RM2343_2022-06-19_Y', '2022-06-19 08:40:00', 160],
            ['BWVCPD_RM28_2022-06-19_Y', '2022-06-19 09:20:00', 120],
            ['IQXECO_RM70_2022-06-19_Y', '2022-06-19 09:30:00', 80],
            ['TNFCWU_RM2468_2022-06-19_Y', '2022-06-19 09:50:00', 100],
            ['NERJPG_RM2476_2022-06-19_Y', '2022-06-19 10:40:00', 140],
            ['TCQTOI_RM1653_2022-06-19_Y', '2022-06-19 10:40:00', 80],
            ['ECOTCW_RM403_2022-06-19_Y', '2022-06-19 11:10:00', 70],
            ['PCNTCQ_RM988_2022-06-19_Y', '2022-06-19 12:40:00', 80],
            ['CYLURD_RM891_2022-06-19_Y', '2022-06-19 12:40:00', 140],
            ['PTGEGQ_RM1203_2022-06-19_Y', '2022-06-19 12:50:00', 140],
            ['PCNQJA_RM547_2022-06-19_Y', '2022-06-19 12:50:00', 110],
            ['CYLCPD_RM626_2022-06-19_Y', '2022-06-19 13:50:00', 100],
            ['CWUTLF_RM1458_2022-06-19_Y', '2022-06-19 13:50:00', 60],
            ['TCWNUB_RM539_2022-06-19_Y', '2022-06-19 15:00:00', 90],
            ['TVOMID_RM1907_2022-06-19_Y', '2022-06-19 15:20:00', 160],
            ['TOITCQ_RM233_2022-06-19_Y', '2022-06-19 15:30:00', 100],
            ['TLFEGQ_RM1514_2022-06-19_Y', '2022-06-19 16:30:00', 160],
            ['DOKECO_RM1636_2022-06-19_Y', '2022-06-19 17:10:00', 140],
            ['TOICWU_RM1560_2022-06-19_Y', '2022-06-19 17:10:00', 80],
            ['NFZNEL_RM2524_2022-06-19_Y', '2022-06-19 17:20:00', 80],
            ['PCNTGD_RM1858_2022-06-19_Y', '2022-06-19 17:20:00', 120],
            ['MCVPCN_RM1373_2022-06-19_Y', '2022-06-19 17:30:00', 90],
            ['TCQPCN_RM2299_2022-06-19_Y', '2022-06-19 17:40:00', 90],
            ['QJAJPG_RM1440_2022-06-19_Y', '2022-06-19 18:00:00', 210],
            ['ECOFNS_RM116_2022-06-19_Y', '2022-06-19 18:20:00', 100],
            ['NFZECO_RM1413_2022-06-19_Y', '2022-06-19 18:20:00', 130],
            ['TCQEGQ_RM611_2022-06-19_Y', '2022-06-19 18:50:00', 140],
            ['NUBECO_RM90_2022-06-19_Y', '2022-06-19 18:50:00', 80],
            ['TCQMCV_RM1074_2022-06-19_Y', '2022-06-19 19:10:00', 60],
            ['CPDBVO_RM819_2022-06-19_Y', '2022-06-19 19:10:00', 70],
            ['IQXEED_RM2712_2022-06-19_Y', '2022-06-19 19:20:00', 190],
            ['MIEPCN_RM2614_2022-06-19_Y', '2022-06-19 19:40:00', 80],
            ['NFZEGQ_RM306_2022-06-19_Y', '2022-06-19 19:50:00', 140],
            ['CYLECO_RM562_2022-06-19_Y', '2022-06-19 20:00:00', 180],
            ['QJATPD_RM1996_2022-06-19_Y', '2022-06-19 20:00:00', 80],
            ['ECONUB_RM1819_2022-06-19_Y', '2022-06-19 20:10:00', 90],
            ['TCQSPR_RM1945_2022-06-19_Y', '2022-06-19 20:40:00', 80],
            ['ECOCYL_RM1148_2022-06-19_Y', '2022-06-19 20:40:00', 180],
            ['ECOBVO_RM1901_2022-06-19_Y', '2022-06-19 20:50:00', 130],
            ['TLFEGQ_RM713_2022-06-19_Y', '2022-06-19 21:20:00', 150],
            ['JPGBVO_RM574_2022-06-19_Y', '2022-06-19 21:20:00', 90],
            ['TLFTCQ_RM2968_2022-06-19_Y', '2022-06-19 21:30:00', 80],
            ['TOITCQ_RM848_2022-06-19_Y', '2022-06-19 21:40:00', 90],
            ['MCVPCN_RM43_2022-06-19_Y', '2022-06-19 21:40:00', 80],
            ['QJAMCV_RM840_2022-06-19_Y', '2022-06-19 21:50:00', 70],
            ['NUBCPD_RM2616_2022-06-19_Y', '2022-06-19 22:00:00', 90],
            ['TGDQJA_RM1239_2022-06-19_Y', '2022-06-19 22:10:00', 180],
            ['FNSECO_RM679_2022-06-19_Y', '2022-06-19 22:10:00', 100],
            ['BDTIQX_RM2626_2022-06-19_Y', '2022-06-19 22:10:00', 120],
            ['NFZNER_RM1489_2022-06-19_Y', '2022-06-19 22:50:00', 160],
            ['CYLURD_RM1288_2022-06-20_Y', '2022-06-20 05:00:00', 140],
            ['PPWQJA_RM1780_2022-06-20_Y', '2022-06-20 05:00:00', 60],
            ['TGDTOI_RM1893_2022-06-20_Y', '2022-06-20 05:00:00', 120],
            ['SPRMCV_RM2175_2022-06-20_Y', '2022-06-20 05:30:00', 80],
            ['PCNTGD_RM437_2022-06-20_Y', '2022-06-20 05:50:00', 140],
            ['MCVQJA_RM196_2022-06-20_Y', '2022-06-20 06:00:00', 70],
            ['CYLBVO_RM815_2022-06-20_Y', '2022-06-20 06:10:00', 110],
            ['CPDTCW_RM1202_2022-06-20_Y', '2022-06-20 06:10:00', 140],
            ['CPDBWV_RM125_2022-06-20_Y', '2022-06-20 06:40:00', 130],
            ['BVONFZ_RM2450_2022-06-20_Y', '2022-06-20 07:00:00', 110],
            ['BWVGNO_RM58_2022-06-20_Y', '2022-06-20 07:00:00', 170],
            ['EGQTVO_RM2601_2022-06-20_Y', '2022-06-20 07:20:00', 140],
            ['TCWNFZ_RM1161_2022-06-20_Y', '2022-06-20 07:30:00', 160],
            ['ECOBDT_RM3076_2022-06-20_Y', '2022-06-20 07:50:00', 100],
            ['NFZTVO_RM352_2022-06-20_Y', '2022-06-20 08:00:00', 60],
            ['ECOQJA_RM753_2022-06-20_Y', '2022-06-20 08:20:00', 140],
            ['TOIMCA_RM880_2022-06-20_Y', '2022-06-20 08:30:00', 80],
            ['TCQTLF_RM2189_2022-06-20_Y', '2022-06-20 08:50:00', 90],
            ['BWVEGQ_RM1285_2022-06-20_Y', '2022-06-20 09:30:00', 120],
            ['QJABWV_RM1420_2022-06-20_Y', '2022-06-20 09:30:00', 140],
            ['EGQTOI_RM362_2022-06-20_Y', '2022-06-20 10:00:00', 140],
            ['IPOTOI_RM1773_2022-06-20_Y', '2022-06-20 10:00:00', 340],
            ['TVOIQX_RM438_2022-06-20_Y', '2022-06-20 10:10:00', 120],
            ['PCNTPD_RM1244_2022-06-20_Y', '2022-06-20 10:10:00', 80],
            ['NELNUB_RM3280_2022-06-20_Y', '2022-06-20 10:30:00', 120],
            ['QJATGD_RM1545_2022-06-20_Y', '2022-06-20 10:30:00', 180],
            ['CWUBWV_RM363_2022-06-20_Y', '2022-06-20 10:30:00', 180],
            ['MCAMCV_RM2302_2022-06-20_Y', '2022-06-20 10:40:00', 80],
            ['NELNFZ_RM1288_2022-06-20_Y', '2022-06-20 10:40:00', 80],
            ['PCNMCA_RM881_2022-06-20_Y', '2022-06-20 10:50:00', 80],
            ['BDTEGQ_RM1630_2022-06-20_Y', '2022-06-20 11:00:00', 70],
            ['TLFQJA_RM248_2022-06-20_Y', '2022-06-20 11:00:00', 120],
            ['MCAMCV_RM2623_2022-06-20_Y', '2022-06-20 11:30:00', 70],
            ['PIJMCV_RM707_2022-06-20_Y', '2022-06-20 11:40:00', 360],
            ['CWUMCV_RM1657_2022-06-20_Y', '2022-06-20 11:40:00', 70],
            ['NFZTCQ_RM773_2022-06-20_Y', '2022-06-20 11:50:00', 240],
            ['TVOTCQ_RM342_2022-06-20_Y', '2022-06-20 11:50:00', 220],
            ['IQXNFZ_RM1704_2022-06-20_Y', '2022-06-20 12:00:00', 160],
            ['ECOPTG_RM198_2022-06-20_Y', '2022-06-20 12:10:00', 140],
            ['TVOEED_RM2612_2022-06-20_Y', '2022-06-20 12:10:00', 120],
            ['MCVCWU_RM1584_2022-06-20_Y', '2022-06-20 12:30:00', 60],
            ['URDTVO_RM129_2022-06-20_Y', '2022-06-20 12:40:00', 140],
            ['EGQECO_RM911_2022-06-20_Y', '2022-06-20 12:40:00', 120],
            ['TLFTCQ_RM1964_2022-06-20_Y', '2022-06-20 13:00:00', 80],
            ['EEDTVO_RM1057_2022-06-20_Y', '2022-06-20 13:30:00', 120],
            ['ECONUB_RM2506_2022-06-20_Y', '2022-06-20 13:40:00', 80],
            ['BVOECO_RM214_2022-06-20_Y', '2022-06-20 13:50:00', 130],
            ['TCQTOI_RM2046_2022-06-20_Y', '2022-06-20 14:00:00', 90],
            ['MCAEGQ_RM66_2022-06-20_Y', '2022-06-20 14:10:00', 150],
            ['CWUPCN_RM242_2022-06-20_Y', '2022-06-20 14:20:00', 60],
            ['EEDECO_RM1294_2022-06-20_Y', '2022-06-20 14:20:00', 180],
            ['IQXBVO_RM1022_2022-06-20_Y', '2022-06-20 14:20:00', 120],
            ['TOITPD_RM1787_2022-06-20_Y', '2022-06-20 14:40:00', 90],
            ['ECOBWV_RM1990_2022-06-20_Y', '2022-06-20 14:40:00', 60],
            ['CYLNER_RM2453_2022-06-20_Y', '2022-06-20 14:50:00', 140],
            ['PCNPPW_RM2413_2022-06-20_Y', '2022-06-20 15:10:00', 80],
            ['FNSECO_RM520_2022-06-20_Y', '2022-06-20 15:10:00', 100],
            ['ECOTPD_RM1799_2022-06-20_Y', '2022-06-20 15:20:00', 180],
            ['NFZEED_RM1608_2022-06-20_Y', '2022-06-20 15:30:00', 120],
            ['QJATHR_RM1179_2022-06-20_Y', '2022-06-20 15:50:00', 120],
            ['MCVTLF_RM250_2022-06-20_Y', '2022-06-20 16:00:00', 80],
            ['NERNFZ_RM2443_2022-06-20_Y', '2022-06-20 16:00:00', 160],
            ['MCAPCN_RM1515_2022-06-20_Y', '2022-06-20 16:00:00', 80],
            ['CPDEGQ_RM634_2022-06-20_Y', '2022-06-20 16:20:00', 160],
            ['TCQPCN_RM2021_2022-06-20_Y', '2022-06-20 16:30:00', 100],
            ['IQXBDT_RM2594_2022-06-20_Y', '2022-06-20 16:30:00', 130],
            ['PTGBWV_RM1477_2022-06-20_Y', '2022-06-20 16:50:00', 160],
            ['TPDMCV_RM91_2022-06-20_Y', '2022-06-20 17:00:00', 60],
            ['NUBCPD_RM34_2022-06-20_Y', '2022-06-20 17:00:00', 90],
            ['CYLEGQ_RM2578_2022-06-20_Y', '2022-06-20 17:00:00', 200],
            ['MCVECO_RM2543_2022-06-20_Y', '2022-06-20 17:00:00', 160],
            ['URDQJA_RM1402_2022-06-20_Y', '2022-06-20 17:10:00', 240],
            ['TGDMCV_RM2435_2022-06-20_Y', '2022-06-20 17:10:00', 150],
            ['TPDEGQ_RM614_2022-06-20_Y', '2022-06-20 17:10:00', 140],
            ['BWVIQX_RM1495_2022-06-20_Y', '2022-06-20 17:20:00', 50],
            ['TCQMCV_RM807_2022-06-20_Y', '2022-06-20 17:20:00', 70],
            ['TGDTLF_RM55_2022-06-20_Y', '2022-06-20 17:30:00', 130],
            ['ECOIQX_RM1129_2022-06-20_Y', '2022-06-20 17:30:00', 70],
            ['CYLQJA_RM1269_2022-06-20_Y', '2022-06-20 17:50:00', 260],
            ['CPDTCW_RM99_2022-06-20_Y', '2022-06-20 17:50:00', 140],
            ['NUBEED_RM1819_2022-06-20_Y', '2022-06-20 18:00:00', 160],
            ['PCNCWU_RM1573_2022-06-20_Y', '2022-06-20 18:10:00', 70],
            ['EGQMCV_RM1497_2022-06-20_Y', '2022-06-20 18:10:00', 110],
            ['TCQTLF_RM837_2022-06-20_Y', '2022-06-20 18:10:00', 80],
            ['MCVQJA_RM249_2022-06-20_Y', '2022-06-20 18:10:00', 60],
            ['NFZBWV_RM2221_2022-06-20_Y', '2022-06-20 18:20:00', 160],
            ['TLFTPD_RM1376_2022-06-20_Y', '2022-06-20 18:20:00', 70],
            ['TOITCQ_RM975_2022-06-20_Y', '2022-06-20 18:30:00', 90],
            ['TCQTOI_RM1027_2022-06-20_Y', '2022-06-20 18:30:00', 90],
            ['TLFQFA_RM2409_2022-06-20_Y', '2022-06-20 18:30:00', 100],
            ['ECONFZ_RM455_2022-06-20_Y', '2022-06-20 18:30:00', 140],
            ['BVONEL_RM1334_2022-06-20_Y', '2022-06-20 18:40:00', 120],
            ['TLFBWV_RM1163_2022-06-20_Y', '2022-06-20 18:40:00', 220],
            ['NEREGQ_RM641_2022-06-20_Y', '2022-06-20 18:40:00', 220],
            ['BVONFZ_RM2038_2022-06-20_Y', '2022-06-20 18:50:00', 100],
            ['EGQPTG_RM1808_2022-06-20_Y', '2022-06-20 18:50:00', 160],
            ['TVONER_RM1955_2022-06-20_Y', '2022-06-20 18:50:00', 140],
            ['IQXBWV_RM1299_2022-06-20_Y', '2022-06-20 18:50:00', 60],
            ['NERCYL_RM1986_2022-06-20_Y', '2022-06-20 19:00:00', 140],
            ['TOICWU_RM2205_2022-06-20_Y', '2022-06-20 19:00:00', 80],
            ['TPDQJA_RM1046_2022-06-20_Y', '2022-06-20 19:00:00', 60],
            ['CWUQJA_RM2296_2022-06-20_Y', '2022-06-20 19:00:00', 80],
            ['NFZCPD_RM1082_2022-06-20_Y', '2022-06-20 19:00:00', 100],
            ['PCNCWU_RM294_2022-06-20_Y', '2022-06-20 19:00:00', 70],
            ['QJAEGQ_RM1075_2022-06-20_Y', '2022-06-20 19:10:00', 120],
            ['PPWTLF_RM1130_2022-06-20_Y', '2022-06-20 19:10:00', 70],
            ['EGQQJA_RM733_2022-06-20_Y', '2022-06-20 19:20:00', 100],
            ['QJAECO_RM3008_2022-06-20_Y', '2022-06-20 19:30:00', 150],
            ['EGQMCV_RM1015_2022-06-20_Y', '2022-06-20 19:30:00', 100],
            ['TCWEGQ_RM1833_2022-06-20_Y', '2022-06-20 19:30:00', 120],
            ['IQXURD_RM2754_2022-06-20_Y', '2022-06-20 19:40:00', 130],
            ['CWUMCV_RM528_2022-06-20_Y', '2022-06-20 19:40:00', 70],
            ['TGDTLF_RM134_2022-06-20_Y', '2022-06-20 19:40:00', 120],
            ['EEDCPD_RM1369_2022-06-20_Y', '2022-06-20 19:50:00', 100],
            ['BVOCYL_RM469_2022-06-20_Y', '2022-06-20 19:50:00', 120],
            ['TVOURD_RM2577_2022-06-20_Y', '2022-06-20 19:50:00', 140],
            ['MIDTVO_RM593_2022-06-20_Y', '2022-06-20 19:50:00', 140],
            ['CWUTLF_RM1876_2022-06-20_Y', '2022-06-20 19:50:00', 60],
            ['TLFCWU_RM949_2022-06-20_Y', '2022-06-20 20:00:00', 60],
            ['BVOJPG_RM41_2022-06-20_Y', '2022-06-20 20:00:00', 80],
            ['ECONUB_RM1819_2022-06-20_Y', '2022-06-20 20:10:00', 90],
            ['NERIQX_RM57_2022-06-20_Y', '2022-06-20 20:10:00', 140],
            ['MCVTCW_RM1959_2022-06-20_Y', '2022-06-20 20:10:00', 160],
            ['QJANEL_RM1_2022-06-20_Y', '2022-06-20 20:20:00', 160],
            ['GNOECO_RM1823_2022-06-20_Y', '2022-06-20 20:20:00', 160],
            ['IQXBWV_RM373_2022-06-20_Y', '2022-06-20 20:30:00', 60],
            ['JPGEGQ_RM836_2022-06-20_Y', '2022-06-20 20:40:00', 140],
            ['TOIEGQ_RM1483_2022-06-20_Y', '2022-06-20 20:40:00', 150],
            ['CWUTHR_RM2683_2022-06-20_Y', '2022-06-20 20:40:00', 70],
            ['QJAFNS_RM174_2022-06-20_Y', '2022-06-20 20:40:00', 80],
            ['TCQSPR_RM1945_2022-06-20_Y', '2022-06-20 20:40:00', 80],
            ['TPDQJA_RM3008_2022-06-20_Y', '2022-06-20 20:50:00', 70],
            ['BWVECO_RM2218_2022-06-20_Y', '2022-06-20 20:50:00', 60],
            ['NELMCV_RM2326_2022-06-20_Y', '2022-06-20 20:50:00', 160],
            ['TPDTOI_RM1383_2022-06-20_Y', '2022-06-20 20:50:00', 80],
            ['CWUMCV_RM2127_2022-06-20_Y', '2022-06-20 20:50:00', 60],
            ['MCVPPW_RM1130_2022-06-20_Y', '2022-06-20 20:50:00', 60],
            ['PCNTPD_RM2775_2022-06-20_Y', '2022-06-20 20:50:00', 80],
            ['ECOCPD_RM940_2022-06-20_Y', '2022-06-20 21:00:00', 110],
            ['ECOIQX_RM2366_2022-06-20_Y', '2022-06-20 21:00:00', 60],
            ['TLFQJA_RM135_2022-06-20_Y', '2022-06-20 21:10:00', 100],
            ['EGQTPD_RM849_2022-06-20_Y', '2022-06-20 21:10:00', 140],
            ['PTGCYL_RM2167_2022-06-20_Y', '2022-06-20 21:10:00', 120],
            ['EGQJPG_RM1204_2022-06-20_Y', '2022-06-20 21:10:00', 160],
            ['NELQJA_RM69_2022-06-20_Y', '2022-06-20 21:10:00', 140],
            ['TLFEGQ_RM713_2022-06-20_Y', '2022-06-20 21:20:00', 150],
            ['ECONUB_RM3188_2022-06-20_Y', '2022-06-20 21:20:00', 80],
            ['EGQMID_RM1588_2022-06-20_Y', '2022-06-20 21:20:00', 260],
            ['PCNCWU_RM1977_2022-06-20_Y', '2022-06-20 21:30:00', 70],
            ['TOITGD_RM1320_2022-06-20_Y', '2022-06-20 21:30:00', 100],
            ['ECOTCW_RM2012_2022-06-20_Y', '2022-06-20 21:40:00', 60],
            ['JPGURD_RM703_2022-06-20_Y', '2022-06-20 21:40:00', 130],
            ['PCNNFZ_RM1371_2022-06-20_Y', '2022-06-20 21:50:00', 260],
            ['BDTMCA_RM531_2022-06-20_Y', '2022-06-20 21:50:00', 110],
            ['MCVEGQ_RM1343_2022-06-20_Y', '2022-06-20 21:50:00', 100],
            ['TOIQJA_RM1206_2022-06-20_Y', '2022-06-20 21:50:00', 100],
            ['GNONER_RM1986_2022-06-20_Y', '2022-06-20 21:50:00', 60],
            ['IQXCPD_RM1931_2022-06-20_Y', '2022-06-20 22:00:00', 120],
            ['MCVTLF_RM2855_2022-06-20_Y', '2022-06-20 22:00:00', 80],
            ['NUBCPD_RM2616_2022-06-20_Y', '2022-06-20 22:00:00', 90],
            ['EGQBWV_RM264_2022-06-20_Y', '2022-06-20 22:10:00', 130],
            ['BWVCPD_RM825_2022-06-20_Y', '2022-06-20 22:10:00', 120],
            ['QJATLF_RM1530_2022-06-20_Y', '2022-06-20 22:10:00', 110],
            ['QJAIQX_RM2768_2022-06-20_Y', '2022-06-20 22:10:00', 150],
            ['TCQQJA_RM340_2022-06-20_Y', '2022-06-20 22:10:00', 70],
            ['ECOBWV_RM1927_2022-06-20_Y', '2022-06-20 22:20:00', 60],
            ['TOIMCV_RM2350_2022-06-20_Y', '2022-06-20 22:20:00', 90],
            ['NERBVO_RM675_2022-06-20_Y', '2022-06-20 22:20:00', 80],
            ['TCWIQX_RM1079_2022-06-20_Y', '2022-06-20 22:20:00', 60],
            ['THREGQ_RM1659_2022-06-20_Y', '2022-06-20 22:30:00', 160],
            ['QFAEGQ_RM2542_2022-06-20_Y', '2022-06-20 22:30:00', 160],
            ['QJAPCN_RM1345_2022-06-20_Y', '2022-06-20 22:30:00', 120],
            ['MCVBWV_RM1300_2022-06-20_Y', '2022-06-20 22:40:00', 160],
            ['NUBBVO_RM2084_2022-06-20_Y', '2022-06-20 22:50:00', 80],
            ['NELNFZ_RM1116_2022-06-20_Y', '2022-06-20 22:50:00', 80],
            ['MCVIQX_RM1874_2022-06-20_Y', '2022-06-20 22:50:00', 180],
            ['CPDNFZ_RM2486_2022-06-20_Y', '2022-06-20 22:50:00', 80]
        ]
        cls.airport_list = [
            ['BDT', 'America/Denver'],
            ['BVO', 'America/New_York'],
            ['BWV', 'America/Chicago'],
            ['CPD', 'America/Chicago'],
            ['CWU', 'America/Los_Angeles'],
            ['CYL', 'America/New_York'],
            ['DOK', 'America/New_York'],
            ['ECO', 'America/Chicago'],
            ['EED', 'America/New_York'],
            ['EGQ', 'America/Denver'],
            ['FNS', 'America/Denver'],
            ['GNO', 'America/New_York'],
            ['IPO', 'America/Indiana/Indianapolis'],
            ['IQX', 'America/Chicago'],
            ['JPG', 'America/Los_Angeles'],
            ['MCA', 'America/Los_Angeles'],
            ['MCV', 'America/Los_Angeles'],
            ['MID', 'America/New_York'],
            ['MIE', 'America/Los_Angeles'],
            ['NEL', 'America/Chicago'],
            ['NER', 'America/New_York'],
            ['NFZ', 'America/Chicago'],
            ['NUB', 'America/Chicago'],
            ['PCN', 'America/Los_Angeles'],
            ['PIJ', 'America/Bogota'],
            ['PPW', 'America/Los_Angeles'],
            ['PTG', 'America/Chicago'],
            ['QFA', 'America/Los_Angeles'],
            ['QJA', 'America/Phoenix'],
            ['SPR', 'America/Los_Angeles'],
            ['TCQ', 'America/Los_Angeles'],
            ['TCW', 'America/Chicago'],
            ['TGD', 'America/Los_Angeles'],
            ['THR', 'America/Los_Angeles'],
            ['TLF', 'America/Los_Angeles'],
            ['TNF', 'America/Denver'],
            ['TOI', 'America/Los_Angeles'],
            ['TPD', 'America/Los_Angeles'],
            ['TVO', 'America/Chicago'],
            ['URD', 'America/Chicago']]
        cls.itin_list = StringVector([
            'CPDBVO_RM819_2022-06-19_Y;BVOCYL_RM469_2022-06-20_Y',
            'CWUPCN_RM242_2022-06-20_Y;PCNCWU_RM1573_2022-06-20_Y;CWUTLF_RM1876_2022-06-20_Y',
            'DOKECO_RM1636_2022-06-19_Y;ECOCYL_RM1148_2022-06-19_Y',
            'TLFTCQ_RM2968_2022-06-19_Y;TCQTOI_RM1027_2022-06-20_Y;TOIEGQ_RM1483_2022-06-20_Y',
            'TOITCQ_RM1324_2022-06-19_Y;TCQMCV_RM1074_2022-06-19_Y',
            'NELNUB_RM3280_2022-06-20_Y;NUBCPD_RM34_2022-06-20_Y',
            'TVONER_RM1955_2022-06-20_Y;NERBVO_RM675_2022-06-20_Y',
            'PCNTGD_RM1858_2022-06-19_Y;TGDTLF_RM134_2022-06-20_Y',
            'ECONUB_RM1819_2022-06-19_Y;NUBBVO_RM2084_2022-06-20_Y',
            'CYLBVO_RM815_2022-06-20_Y;BVONFZ_RM2038_2022-06-20_Y',
            'TLFTPD_RM1376_2022-06-20_Y;TPDTOI_RM1383_2022-06-20_Y;TOIMCV_RM2350_2022-06-20_Y',
            'NFZECO_RM1413_2022-06-19_Y;ECOBWV_RM1990_2022-06-20_Y',
            'EGQPTG_RM1808_2022-06-20_Y',
            'CYLURD_RM891_2022-06-19_Y;URDTVO_RM129_2022-06-20_Y',
            'BVOECO_RM214_2022-06-20_Y;ECOTPD_RM1799_2022-06-20_Y',
            'TPDQJA_RM3008_2022-06-20_Y;QJAPCN_RM1345_2022-06-20_Y',
            'BWVGNO_RM58_2022-06-20_Y;GNONER_RM1986_2022-06-20_Y',
            'NELNFZ_RM1116_2022-06-20_Y',
            'CYLEGQ_RM2578_2022-06-20_Y;EGQTPD_RM849_2022-06-20_Y',
            'CPDEGQ_RM634_2022-06-20_Y;EGQMCV_RM1015_2022-06-20_Y;MCVIQX_RM1874_2022-06-20_Y',
            'TLFTCQ_RM1964_2022-06-20_Y;TCQMCV_RM807_2022-06-20_Y',
            'PCNQJA_RM547_2022-06-19_Y;QJAMCV_RM840_2022-06-19_Y;MCVQJA_RM196_2022-06-20_Y',
            'TOITCQ_RM233_2022-06-19_Y;TCQPCN_RM2299_2022-06-19_Y;PCNTPD_RM1244_2022-06-20_Y;TPDEGQ_RM614_2022-06-20_Y',
            'ECOCPD_RM940_2022-06-20_Y',
            'CYLURD_RM1288_2022-06-20_Y;URDQJA_RM1402_2022-06-20_Y;QJAEGQ_RM1075_2022-06-20_Y',
            'MIEPCN_RM2614_2022-06-19_Y;PCNMCA_RM881_2022-06-20_Y',
            'MCVPCN_RM43_2022-06-19_Y;PCNTGD_RM437_2022-06-20_Y;TGDTLF_RM55_2022-06-20_Y;TLFQJA_RM135_2022-06-20_Y',
            'ECOTCW_RM2012_2022-06-20_Y',
            'TLFCWU_RM2051_2022-06-19_Y;CWUTLF_RM1458_2022-06-19_Y;TLFQJA_RM248_2022-06-20_Y',
            'PPWQJA_RM1780_2022-06-20_Y;QJAPCN_RM1345_2022-06-20_Y',
            'TNFCWU_RM2468_2022-06-19_Y;CWUMCV_RM1657_2022-06-20_Y',
            'PCNNFZ_RM1371_2022-06-20_Y',
            'TCWEGQ_RM1833_2022-06-20_Y;EGQJPG_RM1204_2022-06-20_Y',
            'TOICWU_RM1560_2022-06-19_Y;CWUQJA_RM2296_2022-06-20_Y',
            'GNOECO_RM1823_2022-06-20_Y;ECOBWV_RM1927_2022-06-20_Y',
            'BDTIQX_RM2626_2022-06-19_Y;IQXBVO_RM1022_2022-06-20_Y;BVONEL_RM1334_2022-06-20_Y;NELQJA_RM69_2022-06-20_Y',
            'TGDTOI_RM1893_2022-06-20_Y;TOITGD_RM1320_2022-06-20_Y',
            'NFZTCQ_RM773_2022-06-20_Y;TCQTOI_RM2046_2022-06-20_Y',
            'QJAECO_RM3008_2022-06-20_Y',
            'BWVCPD_RM28_2022-06-19_Y;CPDTCW_RM99_2022-06-20_Y',
            'BWVEGQ_RM1285_2022-06-20_Y;EGQBWV_RM264_2022-06-20_Y',
            'TCQTLF_RM2189_2022-06-20_Y;TLFBWV_RM1163_2022-06-20_Y',
            'EGQFNS_RM1695_2022-06-19_Y;FNSECO_RM679_2022-06-19_Y;ECONFZ_RM455_2022-06-20_Y',
            'PTGEGQ_RM1203_2022-06-19_Y;EGQTOI_RM362_2022-06-20_Y;TOITCQ_RM975_2022-06-20_Y;TCQSPR_RM1945_2022-06-20_Y',
            'EGQECO_RM911_2022-06-20_Y;ECOIQX_RM2366_2022-06-20_Y',
            'PIJMCV_RM707_2022-06-20_Y;MCVPPW_RM1130_2022-06-20_Y',
            'ECOTCW_RM403_2022-06-19_Y;TCWNFZ_RM1161_2022-06-20_Y;NFZEED_RM1608_2022-06-20_Y;EEDCPD_RM1369_2022-06-20_Y',
            'NERJPG_RM2476_2022-06-19_Y;JPGBVO_RM574_2022-06-19_Y',
            'MCVPCN_RM1373_2022-06-19_Y;PCNPPW_RM2413_2022-06-20_Y;PPWTLF_RM1130_2022-06-20_Y',
            'TCQPCN_RM2021_2022-06-20_Y;PCNTPD_RM2775_2022-06-20_Y',
            'IQXEED_RM2712_2022-06-19_Y;EEDTVO_RM1057_2022-06-20_Y;TVOURD_RM2577_2022-06-20_Y',
            'MCAEGQ_RM66_2022-06-20_Y;EGQMID_RM1588_2022-06-20_Y',
            'EEDECO_RM1294_2022-06-20_Y;ECOIQX_RM1129_2022-06-20_Y;IQXBWV_RM373_2022-06-20_Y',
            'BWVNEL_RM3580_2022-06-19_Y;NELMCV_RM2326_2022-06-20_Y;MCVBWV_RM1300_2022-06-20_Y',
            'ECONUB_RM2506_2022-06-20_Y;NUBEED_RM1819_2022-06-20_Y',
            'CYLECO_RM562_2022-06-19_Y;ECOBDT_RM3076_2022-06-20_Y',
            'TOITPD_RM1787_2022-06-20_Y;TPDMCV_RM91_2022-06-20_Y;MCVQJA_RM249_2022-06-20_Y;QJANEL_RM1_2022-06-20_Y',
            'TOITCQ_RM848_2022-06-19_Y;TCQTLF_RM837_2022-06-20_Y;TLFEGQ_RM713_2022-06-20_Y',
            'TVOMID_RM1907_2022-06-19_Y;MIDTVO_RM593_2022-06-20_Y',
            'ECONUB_RM1819_2022-06-20_Y;NUBCPD_RM2616_2022-06-20_Y',
            'TLFQFA_RM2409_2022-06-20_Y;QFAEGQ_RM2542_2022-06-20_Y',
            'TVOTCQ_RM342_2022-06-20_Y;TCQQJA_RM340_2022-06-20_Y',
            'MCVCWU_RM1584_2022-06-20_Y;CWUMCV_RM528_2022-06-20_Y;MCVEGQ_RM1343_2022-06-20_Y',
            'MCVBDT_RM1171_2022-06-19_Y;BDTEGQ_RM1630_2022-06-20_Y',
            'ECOBVO_RM1901_2022-06-19_Y;BVOJPG_RM41_2022-06-20_Y;JPGURD_RM703_2022-06-20_Y',
            'CYLQJA_RM1269_2022-06-20_Y;QJAIQX_RM2768_2022-06-20_Y',
            'NERNFZ_RM2443_2022-06-20_Y;NFZCPD_RM1082_2022-06-20_Y;CPDNFZ_RM2486_2022-06-20_Y',
            'NFZNER_RM1489_2022-06-19_Y;NERIQX_RM57_2022-06-20_Y;IQXCPD_RM1931_2022-06-20_Y',
            'NEREGQ_RM641_2022-06-20_Y;EGQJPG_RM1204_2022-06-20_Y',
            'TVOIQX_RM438_2022-06-20_Y;IQXBDT_RM2594_2022-06-20_Y;BDTMCA_RM531_2022-06-20_Y',
            'TGDQJA_RM1239_2022-06-19_Y;QJATHR_RM1179_2022-06-20_Y',
            'MCAPCN_RM1515_2022-06-20_Y;PCNCWU_RM294_2022-06-20_Y;CWUMCV_RM2127_2022-06-20_Y;MCVTLF_RM2855_2022-06-20_Y',
            'CWUBWV_RM363_2022-06-20_Y;BWVIQX_RM1495_2022-06-20_Y;IQXBWV_RM1299_2022-06-20_Y',
            'NFZNEL_RM2524_2022-06-19_Y;NELNFZ_RM1288_2022-06-20_Y',
            'PTGCYL_RM2167_2022-06-20_Y',
            'MIDCPD_RM2736_2022-06-19_Y;CPDTCW_RM1202_2022-06-20_Y;TCWIQX_RM1079_2022-06-20_Y',
            'THREGQ_RM1659_2022-06-20_Y',
            'QJATLF_RM1901_2022-06-19_Y;TLFEGQ_RM1514_2022-06-19_Y;EGQTVO_RM2601_2022-06-20_Y;TVOEED_RM2612_2022-06-20_Y',
            'TOICWU_RM2205_2022-06-20_Y;CWUTHR_RM2683_2022-06-20_Y;THREGQ_RM1659_2022-06-20_Y',
            'MCAMCV_RM2302_2022-06-20_Y;MCVECO_RM2543_2022-06-20_Y;ECOBWV_RM1927_2022-06-20_Y',
            'QJATGD_RM1545_2022-06-20_Y;TGDMCV_RM2435_2022-06-20_Y;MCVTCW_RM1959_2022-06-20_Y',
            'ECOFNS_RM116_2022-06-19_Y;FNSECO_RM520_2022-06-20_Y;ECONUB_RM3188_2022-06-20_Y',
            'TCWNUB_RM539_2022-06-19_Y;NUBCPD_RM2616_2022-06-19_Y;CPDNFZ_RM2486_2022-06-20_Y',
            'BVONFZ_RM2450_2022-06-20_Y;NFZTVO_RM352_2022-06-20_Y',
            'QJAIQX_RM2343_2022-06-19_Y;IQXURD_RM2754_2022-06-20_Y',
            'PCNTCQ_RM988_2022-06-19_Y;TCQEGQ_RM611_2022-06-19_Y',
            'PCNCWU_RM1977_2022-06-20_Y',
            'TLFCWU_RM949_2022-06-20_Y',
            'IPOTOI_RM1773_2022-06-20_Y;TOIQJA_RM1206_2022-06-20_Y',
            'QJAJPG_RM1440_2022-06-19_Y;JPGEGQ_RM836_2022-06-20_Y;EGQBWV_RM264_2022-06-20_Y',
            'TCQSPR_RM1945_2022-06-19_Y;SPRMCV_RM2175_2022-06-20_Y;MCVTLF_RM250_2022-06-20_Y;TLFQJA_RM135_2022-06-20_Y',
            'TCQTOI_RM1653_2022-06-19_Y;TOIMCA_RM880_2022-06-20_Y;MCAMCV_RM2623_2022-06-20_Y;MCVECO_RM2543_2022-06-20_Y',
            'IQXECO_RM70_2022-06-19_Y;ECOPTG_RM198_2022-06-20_Y;PTGBWV_RM1477_2022-06-20_Y;BWVCPD_RM825_2022-06-20_Y',
            'NFZEGQ_RM306_2022-06-19_Y;EGQQJA_RM733_2022-06-20_Y;QJAFNS_RM174_2022-06-20_Y',
            'NUBECO_RM90_2022-06-19_Y;ECOQJA_RM753_2022-06-20_Y;QJABWV_RM1420_2022-06-20_Y;BWVECO_RM2218_2022-06-20_Y',
            'CYLNER_RM2453_2022-06-20_Y;NERCYL_RM1986_2022-06-20_Y',
            'CYLCPD_RM626_2022-06-19_Y;CPDBWV_RM125_2022-06-20_Y',
            'QJATPD_RM1996_2022-06-19_Y;TPDQJA_RM1046_2022-06-20_Y;QJATLF_RM1530_2022-06-20_Y',
            'TLFEGQ_RM713_2022-06-19_Y;EGQMCV_RM1497_2022-06-20_Y',
            'IQXNFZ_RM1704_2022-06-20_Y;NFZBWV_RM2221_2022-06-20_Y'
        ] * int(1e4))

    def test_compute_total_air_duration(self):
        # One run for warmup
        _ = compute_total_air_duration_min(self.itin_list, self.airport_list, self.leg_list)

        t = time.time()
        res = compute_total_air_duration_min(self.itin_list, self.airport_list, self.leg_list)
        elapsed = time.time() - t
        print(f"{elapsed} seconds elapsed for {len(res)} itins.")
        print(res[:20])
        assert(len(res) == len(self.itin_list))

        itins_df = pd.DataFrame(self.itin_list, columns=['itinerary'])
        legs_df =  pd.DataFrame(self.leg_list, columns=['leg_id', 'departure_datetime_local', 'duration_min'])

        sql_query = """
            SELECT
            row_index,
            SUM(duration_min) AS total_duration_min
            FROM
            (SELECT
            row_index,
            leg_id,
            duration_min,
            itinerary
            FROM legs_df INNER JOIN (
            SELECT
            ROW_NUMBER() OVER() AS row_index,
            itinerary,
            UNNEST(STRING_SPLIT(itinerary, ';')) as leg_ids
            FROM itins_df) ON legs_df.leg_id == leg_ids)
            GROUP BY 1
            ORDER BY row_index
        """

        t = time.time()
        res_df = dbrun(sql_query)
        elapsed = time.time() - t
        print(f"{elapsed} seconds elapsed for {res_df.shape[0]} itins.")
        print(np.sum(np.array(res) == -99999))

        assert(res_df.shape[0] == len(self.itin_list))
        # Results from cpp and from DuckDB must be identical.
        assert(res_df.loc[:, 'total_duration_min'].values.tolist() == res)
           
    def test_compute_total_duration(self):
        # One run for warmup
        _ = compute_total_duration_min(self.itin_list, self.airport_list, self.leg_list)

        t = time.time()
        res = compute_total_duration_min(self.itin_list, self.airport_list, self.leg_list)
        elapsed = time.time() - t
        print(f"{elapsed} seconds elapsed for {len(res)} itins.")
        print(res[:20])
        assert(len(res) == len(self.itin_list))



if __name__ == '__main__':
    unittest.main(verbosity=2)
